# ç©å®¶è§’è‰²ç³»ç»Ÿ - ç®¡ç†ç©å®¶å±æ€§ã€èƒŒåŒ…ã€çŠ¶æ€

classes:
  Item:
    # ç‰©å“ç±»
    init: (id, name, description, item_type, value) => {
        this.id = id
        this.name = name
        this.description = description
        this.type = item_type  # weapon, armor, consumable, key, misc
        this.value = value
        this.quantity = 1
        this.equipped = false
        this.stats = {}  # é¢å¤–å±æ€§å¦‚æ”»å‡»åŠ›ã€é˜²å¾¡åŠ›ç­‰
      }
    
    # è®¾ç½®ç‰©å“å±æ€§
    set_stat: (key, value) => {
        this.stats[key] = value
      }
    
    # è·å–ç‰©å“å±æ€§
    get_stat: (key, default_val) => {
        if (key in this.stats) {
          return this.stats[key]
        }
        return default_val
      }
    
    # æ˜¾ç¤ºç‰©å“ä¿¡æ¯
    get_info: () => {
        info = this.name
        if (this.quantity > 1) {
          info = info + " x" + str(this.quantity)
        }
        if (this.equipped) {
          info = info + " [å·²è£…å¤‡]"
        }
        return info
      }

  Inventory:
    # èƒŒåŒ…ç³»ç»Ÿ
    init: (capacity) => {
        if (capacity == null) {
          capacity = 20
        }
        this.capacity = capacity
        this.items = []
        this.gold = 0
      }
    
    # æ·»åŠ ç‰©å“
    add_item: (item) => {
        # æ£€æŸ¥æ˜¯å¦å¯å †å 
        if (item.type == "consumable" || item.type == "misc") {
          for (i = 0; i < len(this.items); i++) :
            existing = this.items[i]
            if (existing.id == item.id) {
              existing.quantity = existing.quantity + item.quantity
              return true
            }
        }
        
        # æ£€æŸ¥å®¹é‡
        if (len(this.items) >= this.capacity) {
          return false
        }
        
        this.items = this.items + [item]
        return true
      }
    
    # ç§»é™¤ç‰©å“
    remove_item: (index, quantity) => {
        if (quantity == null) {
          quantity = 1
        }
        if (index < 0 || index >= len(this.items)) {
          return null
        }
        item = this.items[index]
        if (item.quantity <= quantity) {
          # ç§»é™¤æ•´ä¸ªç‰©å“
          new_items = []
          for (i = 0; i < len(this.items); i++) :
            if (i != index) {
              new_items = new_items + [this.items[i]]
            }
          this.items = new_items
          return item
        } else {
          # å‡å°‘æ•°é‡
          item.quantity = item.quantity - quantity
          # åˆ›å»ºå‰¯æœ¬è¿”å›
          copy = Item(item.id, item.name, item.description, item.type, item.value)
          copy.quantity = quantity
          return copy
        }
      }
    
    # è·å–ç‰©å“
    get_item: (index) => {
        if (index < 0 || index >= len(this.items)) {
          return null
        }
        return this.items[index]
      }
    
    # æŸ¥æ‰¾ç‰©å“
    find_item: (item_id) => {
        for (i = 0; i < len(this.items); i++) :
          if (this.items[i].id == item_id) {
            return i
          }
        return -1
      }
    
    # æ£€æŸ¥æ˜¯å¦æœ‰ç‰©å“
    has_item: (item_id) => {
        return this.find_item(item_id) >= 0
      }
    
    # è·å–ç‰©å“åˆ—è¡¨
    get_item_list: () => {
        list = []
        for (i = 0; i < len(this.items); i++) :
          item = this.items[i]
          list = list + [str(i + 1) + ". " + item.get_info()]
        return list
      }
    
    # è·å–å·²è£…å¤‡æ­¦å™¨
    get_equipped_weapon: () => {
        for (i = 0; i < len(this.items); i++) :
          item = this.items[i]
          if (item.type == "weapon" && item.equipped) {
            return item
          }
        return null
      }
    
    # è·å–å·²è£…å¤‡é˜²å…·
    get_equipped_armor: () => {
        for (i = 0; i < len(this.items); i++) :
          item = this.items[i]
          if (item.type == "armor" && item.equipped) {
            return item
          }
        return null
      }
    
    # è£…å¤‡ç‰©å“
    equip_item: (index) => {
        if (index < 0 || index >= len(this.items)) {
          return false
        }
        item = this.items[index]
        
        # å–æ¶ˆåŒç±»å‹å…¶ä»–è£…å¤‡çš„è£…å¤‡çŠ¶æ€
        if (item.type == "weapon" || item.type == "armor") {
          for (i = 0; i < len(this.items); i++) :
            other = this.items[i]
            if (other.type == item.type) {
              other.equipped = false
            }
        }
        
        item.equipped = true
        return true
      }
    
    # å¸ä¸‹è£…å¤‡
    unequip_item: (index) => {
        if (index < 0 || index >= len(this.items)) {
          return false
        }
        this.items[index].equipped = false
        return true
      }
    
    # æ·»åŠ é‡‘å¸
    add_gold: (amount) => {
        this.gold = this.gold + amount
        return this.gold
      }
    
    # æ¶ˆè´¹é‡‘å¸
    spend_gold: (amount) => {
        if (this.gold < amount) {
          return false
        }
        this.gold = this.gold - amount
        return true
      }

  Player:
    # ç©å®¶è§’è‰²
    init: (name) => {
        this.name = name
        this.level = 1
        this.exp = 0
        this.exp_to_next = 100
        
        # åŸºç¡€å±æ€§
        this.max_hp = 100
        this.hp = 100
        this.max_mp = 50
        this.mp = 50
        
        # æˆ˜æ–—å±æ€§
        this.strength = 10  # åŠ›é‡ï¼Œå½±å“ç‰©ç†æ”»å‡»
        this.agility = 10   # æ•æ·ï¼Œå½±å“é€Ÿåº¦å’Œé—ªé¿
        this.intelligence = 10  # æ™ºåŠ›ï¼Œå½±å“é­”æ³•æ”»å‡»å’ŒMP
        this.vitality = 10  # ä½“è´¨ï¼Œå½±å“HPå’Œé˜²å¾¡
        
        # çŠ¶æ€
        this.status = "normal"  # normal, poisoned, paralyzed, etc.
        this.location = "start"
        
        # èƒŒåŒ…
        this.inventory = Inventory(20)
        
        # ä»»åŠ¡è®°å½•
        this.quests = []
        this.completed_quests = []
        
        # æ¸¸æˆç»Ÿè®¡
        this.stats = {
          "monsters_killed": 0,
          "deaths": 0,
          "items_found": 0,
          "gold_earned": 0,
          "play_time": 0
        }
      }
    
    # è®¡ç®—å±æ€§å€¼ï¼ˆåŒ…å«è£…å¤‡åŠ æˆï¼‰
    get_attack: () => {
        base = this.strength
        weapon = this.inventory.get_equipped_weapon()
        if (weapon != null) {
          bonus = weapon.get_stat("attack", 0)
          base = base + bonus
        }
        return base
      }
    
    get_defense: () => {
        base = this.vitality / 2
        armor = this.inventory.get_equipped_armor()
        if (armor != null) {
          bonus = armor.get_stat("defense", 0)
          base = base + bonus
        }
        return int(base)
      }
    
    get_speed: () => {
        return this.agility
      }
    
    # ç”Ÿå‘½å€¼ç®¡ç†
    heal: (amount) => {
        this.hp = this.hp + amount
        if (this.hp > this.max_hp) {
          this.hp = this.max_hp
        }
        return this.hp
      }
    
    take_damage: (amount) => {
        this.hp = this.hp - amount
        if (this.hp < 0) {
          this.hp = 0
        }
        return this.hp
      }
    
    is_alive: () => {
        return this.hp > 0
      }
    
    # é­”æ³•å€¼ç®¡ç†
    use_mp: (amount) => {
        if (this.mp < amount) {
          return false
        }
        this.mp = this.mp - amount
        return true
      }
    
    restore_mp: (amount) => {
        this.mp = this.mp + amount
        if (this.mp > this.max_mp) {
          this.mp = this.max_mp
        }
        return this.mp
      }
    
    # ç»éªŒå€¼å’Œå‡çº§
    gain_exp: (amount) => {
        this.exp = this.exp + amount
        if (this.exp >= this.exp_to_next) {
          this.level_up()
        }
      }
    
    level_up: () => {
        this.level = this.level + 1
        this.exp = this.exp - this.exp_to_next
        this.exp_to_next = int(this.exp_to_next * 1.5)
        
        # å±æ€§æˆé•¿
        hp_growth = 10 + this.vitality / 5
        mp_growth = 5 + this.intelligence / 5
        
        this.max_hp = this.max_hp + hp_growth
        this.max_mp = this.max_mp + mp_growth
        this.hp = this.max_hp
        this.mp = this.max_mp
        
        echo "ğŸ‰ å‡çº§äº†ï¼ç­‰çº§æå‡åˆ° " + str(this.level)
        echo "   æœ€å¤§HP: +" + str(hp_growth) + "  æœ€å¤§MP: +" + str(mp_growth)
      }
    
    # æ˜¾ç¤ºçŠ¶æ€
    show_status: () => {
        echo ""
        echo "========== è§’è‰²çŠ¶æ€ =========="
        echo "å§“å: " + this.name
        echo "ç­‰çº§: " + str(this.level) + "  (ç»éªŒ: " + str(this.exp) + "/" + str(this.exp_to_next) + ")"
        echo ""
        echo "ç”Ÿå‘½å€¼: " + str(this.hp) + "/" + str(this.max_hp)
        echo "é­”æ³•å€¼: " + str(this.mp) + "/" + str(this.max_mp)
        echo ""
        echo "åŠ›é‡: " + str(this.strength) + "  æ•æ·: " + str(this.agility)
        echo "æ™ºåŠ›: " + str(this.intelligence) + "  ä½“è´¨: " + str(this.vitality)
        echo ""
        echo "æ”»å‡»åŠ›: " + str(this.get_attack()) + "  é˜²å¾¡åŠ›: " + str(this.get_defense())
        echo "é€Ÿåº¦: " + str(this.get_speed())
        echo ""
        echo "é‡‘å¸: " + str(this.inventory.gold)
        echo "çŠ¶æ€: " + this.status
        echo "============================"
      }
    
    # æ˜¾ç¤ºèƒŒåŒ…
    show_inventory: () => {
        echo ""
        echo "========== èƒŒåŒ… =========="
        echo "é‡‘å¸: " + str(this.inventory.gold)
        echo "å®¹é‡: " + str(len(this.inventory.items)) + "/" + str(this.inventory.capacity)
        echo ""
        items = this.inventory.get_item_list()
        if (len(items) == 0) {
          echo "èƒŒåŒ…æ˜¯ç©ºçš„"
        } else {
          for (i = 0; i < len(items); i++) :
            echo items[i]
        }
        echo "=========================="
      }
    
    # æ·»åŠ ä»»åŠ¡
    add_quest: (quest_id, quest_name, description) => {
        quest = {
          "id": quest_id,
          "name": quest_name,
          "description": description,
          "completed": false,
          "objectives": []
        }
        this.quests = this.quests + [quest]
        echo "ğŸ“œ æ¥å—ä»»åŠ¡: " + quest_name
      }
    
    # å®Œæˆä»»åŠ¡
    complete_quest: (quest_id) => {
        for (i = 0; i < len(this.quests); i++) :
          if (this.quests[i].id == quest_id) {
            this.quests[i].completed = true
            this.completed_quests = this.completed_quests + [this.quests[i]]
            echo "âœ… å®Œæˆä»»åŠ¡: " + this.quests[i].name
            return true
          }
        return false
      }
    
    # è·å–è¿›è¡Œä¸­çš„ä»»åŠ¡
    get_active_quests: () => {
        active = []
        for (i = 0; i < len(this.quests); i++) :
          if (!this.quests[i].completed) {
            active = active + [this.quests[i]]
          }
        return active
      }
