# äº¤äº’ç³»ç»Ÿ - å¤„ç†ç”¨æˆ·è¾“å…¥ã€èœå•æ˜¾ç¤ºã€å¯¹è¯ç³»ç»Ÿ

classes:
  InputHandler:
    # èŽ·å–æ•´æ•°è¾“å…¥ï¼Œå¸¦éªŒè¯
    get_int: (prompt, min_val, max_val) => {
        while (true) :
          try :
            if (prompt != null) {
              echo prompt
            }
            input_str = input()
            value = int(input_str)
            if (min_val != null && value < min_val) {
              echo "è¯·è¾“å…¥å¤§äºŽç­‰äºŽ " + str(min_val) + " çš„æ•°å­—"
              continue
            }
            if (max_val != null && value > max_val) {
              echo "è¯·è¾“å…¥å°äºŽç­‰äºŽ " + str(max_val) + " çš„æ•°å­—"
              continue
            }
            return value
          catch (error) :
            echo "æ— æ•ˆè¾“å…¥ï¼Œè¯·è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„æ•°å­—"
      }
    
    # èŽ·å–å­—ç¬¦ä¸²è¾“å…¥
    get_string: (prompt, allow_empty) => {
        if (allow_empty == null) {
          allow_empty = false
        }
        while (true) :
          if (prompt != null) {
            echo prompt
          }
          value = input()
          if (!allow_empty && len(value) == 0) {
            echo "è¾“å…¥ä¸èƒ½ä¸ºç©ºï¼Œè¯·é‡æ–°è¾“å…¥"
            continue
          }
          return value
      }
    
    # èŽ·å–ç¡®è®¤ (Y/N)
    get_confirm: (prompt) => {
        if (prompt == null) {
          prompt = "ç¡®è®¤? (Y/N): "
        }
        while (true) :
          echo prompt
          value = input()
          value_upper = value
          # è½¬æ¢ä¸ºå¤§å†™è¿›è¡Œæ¯”è¾ƒ
          if (value_upper == "Y" || value_upper == "y") {
            return true
          }
          if (value_upper == "N" || value_upper == "n") {
            return false
          }
          echo "è¯·è¾“å…¥ Y æˆ– N"
      }
    
    # èŽ·å–é€‰æ‹©é¡¹
    get_choice: (prompt, options) => {
        echo prompt
        for (i = 0; i < len(options); i++) :
          echo "  " + str(i + 1) + ". " + options[i]
        while (true) :
          echo "è¯·è¾“å…¥é€‰é¡¹ç¼–å· (1-" + str(len(options)) + "): "
          input_str = input()
          try :
            choice = int(input_str)
            if (choice >= 1 && choice <= len(options)) {
              return choice - 1  # è¿”å›ž0-basedç´¢å¼•
            }
            echo "æ— æ•ˆé€‰é¡¹ï¼Œè¯·é‡æ–°è¾“å…¥"
          catch (error) :
            echo "è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—"
      }
    
    # æš‚åœç­‰å¾…ç”¨æˆ·æŒ‰é”®
    pause: (message) => {
        if (message == null) {
          message = "æŒ‰å›žè½¦é”®ç»§ç»­..."
        }
        echo message
        input()
      }

  MenuSystem:
    # æ˜¾ç¤ºèœå•å¹¶èŽ·å–é€‰æ‹©
    show_menu: (title, options) => {
        echo ""
        echo "========== " + title + " =========="
        for (i = 0; i < len(options); i++) :
          echo "  [" + str(i + 1) + "] " + options[i]
        echo "  [0] è¿”å›ž/é€€å‡º"
        echo "=================================="
        
        while (true) :
          echo "è¯·é€‰æ‹©: "
          input_str = input()
          try :
            choice = int(input_str)
            if (choice >= 0 && choice <= len(options)) {
              return choice
            }
            echo "æ— æ•ˆé€‰é¡¹ï¼Œè¯·é‡æ–°è¾“å…¥"
          catch (error) :
            echo "è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—"
      }
    
    # æ˜¾ç¤ºå­èœå•
    show_submenu: (parent_title, submenu_title, options) => {
        full_title = parent_title + " > " + submenu_title
        return this.show_menu(full_title, options)
      }
    
    # æ˜¾ç¤ºåˆ†é¡µåˆ—è¡¨
    show_paged_list: (title, items, page_size) => {
        if (page_size == null) {
          page_size = 10
        }
        total_pages = (len(items) + page_size - 1) / page_size
        if (total_pages < 1) {
          total_pages = 1
        }
        current_page = 0
        
        while (true) :
          start = current_page * page_size
          end = start + page_size
          if (end > len(items)) {
            end = len(items)
          }
          
          echo ""
          echo "========== " + title + " (ç¬¬ " + str(current_page + 1) + "/" + str(total_pages) + " é¡µ) =========="
          for (i = start; i < end; i++) :
            echo "  [" + str(i + 1) + "] " + items[i]
          
          echo ""
          echo "  [N] ä¸‹ä¸€é¡µ  [P] ä¸Šä¸€é¡µ  [Q] é€€å‡º"
          echo "  æˆ–ç›´æŽ¥è¾“å…¥ç¼–å·é€‰æ‹©"
          echo "=================================================="
          
          echo "è¯·é€‰æ‹©: "
          choice = input()
          
          # å¤„ç†å¯¼èˆªå‘½ä»¤
          if (choice == "N" || choice == "n") {
            if (current_page < total_pages - 1) {
              current_page = current_page + 1
            }
            continue
          }
          if (choice == "P" || choice == "p") {
            if (current_page > 0) {
              current_page = current_page - 1
            }
            continue
          }
          if (choice == "Q" || choice == "q") {
            return -1
          }
          
          # å°è¯•è§£æžä¸ºæ•°å­—é€‰æ‹©
          try :
            num_choice = int(choice)
            if (num_choice >= 1 && num_choice <= len(items)) {
              return num_choice - 1
            }
            echo "æ— æ•ˆé€‰é¡¹"
          catch (error) :
            echo "æ— æ•ˆè¾“å…¥"
      }

  DialogSystem:
    # æ˜¾ç¤ºå¯¹è¯
    show_dialog: (speaker, text) => {
        echo ""
        if (speaker != null && len(speaker) > 0) {
          echo "[" + speaker + "]"
        }
        echo "\"" + text + "\""
        echo ""
      }
    
    # æ˜¾ç¤ºå¸¦é€‰é¡¹çš„å¯¹è¯
    show_dialog_with_choices: (speaker, text, choices) => {
        this.show_dialog(speaker, text)
        echo "ä½ çš„å›žåº”:"
        for (i = 0; i < len(choices); i++) :
          echo "  " + str(i + 1) + ". " + choices[i]
        return input_handler.get_choice("", choices)
      }
    
    # æ˜¾ç¤ºå™è¿°æ–‡æœ¬
    show_narration: (text) => {
        echo ""
        echo text
        echo ""
      }
    
    # æ˜¾ç¤ºåœºæ™¯æè¿°
    show_scene: (location, description) => {
        echo ""
        echo "ã€" + location + "ã€‘"
        echo "----------------------------------------"
        echo description
        echo "----------------------------------------"
        echo ""
      }
    
    # æ˜¾ç¤ºç³»ç»Ÿæ¶ˆæ¯
    show_system: (message) => {
        echo "[ç³»ç»Ÿ] " + message
      }
    
    # æ˜¾ç¤ºæˆ˜æ–—ä¿¡æ¯
    show_combat: (attacker, action, target, result) => {
        echo ""
        echo "âš”ï¸  " + attacker + " " + action + " " + target
        if (result != null) {
          echo "   ç»“æžœ: " + result
        }
        echo ""
      }
    
    # æ˜¾ç¤ºèŽ·å¾—ç‰©å“
    show_loot: (item_name, quantity) => {
        if (quantity == null) {
          quantity = 1
        }
        echo ""
        echo "ðŸŽ èŽ·å¾—: " + item_name + " x" + str(quantity)
        echo ""
      }
    
    # æ˜¾ç¤ºå±žæ€§å˜åŒ–
    show_stat_change: (stat_name, old_val, new_val) => {
        diff = new_val - old_val
        if (diff > 0) {
          echo "ðŸ“ˆ " + stat_name + ": " + str(old_val) + " â†’ " + str(new_val) + " (+" + str(diff) + ")"
        } else {
          if (diff < 0) {
            echo "ðŸ“‰ " + stat_name + ": " + str(old_val) + " â†’ " + str(new_val) + " (" + str(diff) + ")"
          } else {
            echo "ðŸ“Š " + stat_name + ": " + str(new_val)
          }
        }
      }

objects:
  input_handler: InputHandler()
  menu_system: MenuSystem()
  dialog_system: DialogSystem()
