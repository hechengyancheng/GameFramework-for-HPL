# 简单冒险游戏示例 - 使用 Python 模块版本
# 这个示例展示了如何使用 hpl_game_framework 的 Python 模块

imports:
  - ../core/game_engine: game_engine
  - ../core/scene: scene
  - ../core/player: player
  - ../utils/interaction: interaction


main: () => {
  # 显示欢迎信息
  interaction.show_narration("简单冒险游戏")
  interaction.show_narration("这是一个使用 Python 模块的 HPL 游戏示例。")
  
  # 获取玩家名称
  player_name = interaction.get_string("请输入你的角色名称: ", false)
  
  # 创建游戏引擎（返回引擎ID）
  engine_id = game_engine.create_game_engine()
  
  # 初始化游戏（传递引擎ID、玩家名称和玩家模块）
  game_engine.initialize_game(engine_id, player_name, player)
  
  # 获取玩家对象
  p = game_engine.get_player(engine_id)

  
  # 创建场景
  forest = scene.create_scene("forest", "迷雾森林", "你站在一片神秘的森林入口。古老的树木高耸入云，雾气在林间缭绕。你听到远处传来奇怪的声音。")
  cave = scene.create_scene("cave", "幽暗洞穴", "一个阴暗潮湿的洞穴。水滴从洞顶落下，发出滴答声。你感觉到有什么东西在黑暗中注视着你。")
  village = scene.create_scene("village", "宁静村庄", "一个宁静的小村庄。村民们友好地向你打招呼，铁匠铺传来叮叮当当的敲打声。")
  
  # 创建选择项并添加到场景
  # 森林的选择
  choice1 = scene.create_choice("进入洞穴探险", "cave", null, null)
  scene.add_choice(forest, choice1)
  
  choice2 = scene.create_choice("前往村庄", "village", null, null)
  scene.add_choice(forest, choice2)
  
  choice3 = scene.create_choice("在森林中搜索", null, null, () => {
    interaction.show_system("你在森林中发现了一些草药！")
    # 获取玩家对象并添加金币
    p = game_engine.get_player(engine_id)
    player.add_gold(p, 10)
    interaction.show_loot("草药", 3)
  })

  scene.add_choice(forest, choice3)
  
  # 洞穴的选择
  choice4 = scene.create_choice("返回森林", "forest", null, null)
  scene.add_choice(cave, choice4)
  
  choice5 = scene.create_choice("深入洞穴", null, null, () => {
    interaction.show_combat("玩家", "攻击", "蝙蝠", "命中！造成 5 点伤害")
    # 获取玩家对象并添加经验
    p = game_engine.get_player(engine_id)
    player.gain_exp(p, 20)
    interaction.show_system("你获得了 20 点经验值！")
  })

  scene.add_choice(cave, choice5)
  
  # 村庄的选择
  choice6 = scene.create_choice("返回森林", "forest", null, null)
  scene.add_choice(village, choice6)
  
  choice7 = scene.create_choice("与村民交谈", null, null, () => {
    interaction.show_dialog("村民", "欢迎来到我们的村庄，旅行者！需要休息吗？")
    # 获取玩家对象并治疗
    p = game_engine.get_player(engine_id)
    old_hp = player.get_player_hp(p)
    player.heal_player(p, 20)
    new_hp = player.get_player_hp(p)
    interaction.show_stat_change("HP", old_hp, new_hp)
  })

  scene.add_choice(village, choice7)
  
  # 注册场景到游戏引擎
  game_engine.register_scene(engine_id, forest)
  game_engine.register_scene(engine_id, cave)
  game_engine.register_scene(engine_id, village)
  
  # 设置起始场景
  game_engine.set_start_scene(engine_id, "forest")
  
  # 获取玩家对象并添加初始物品
  p = game_engine.get_player(engine_id)
  
  # 创建物品
  sword = player.create_item("sword_001", "生锈的剑", "一把生锈的铁剑，但还能用", "weapon", 50)
  player.set_item_stat(sword, "attack", 5)
  player.add_item_to_inventory(p, sword)
  
  potion = player.create_item("potion_001", "生命药水", "恢复 30 点生命值", "consumable", 20)
  player.add_item_to_inventory(p, potion)
  
  # 显示初始状态
  interaction.pause("按回车键开始游戏...")
  player.show_player_status(p)

  
  # 运行游戏
  game_engine.run_game(engine_id)
}
